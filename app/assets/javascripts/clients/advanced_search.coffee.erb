CIF.ClientsAdvanced_search = do ->
  _init = ->
    _initJqueryQueryBuilder()
    _setRuleJqueryQueryBuilder()
    _handleSearch()

  _setRuleJqueryQueryBuilder = ->
    queryRules = $('#builder').data('search-rules')
    queryCondition = $('#builder').data('search-condition')
    if queryRules != undefined
      console.log queryRules
      $('#builder').queryBuilder('setRules', queryRules)

  _initJqueryQueryBuilder = ->
    fieldList = $('#builder').data('field-list')
    $('#builder').queryBuilder
      lang:
        operators:
          equal: 'is'
          not_equal: 'is not'
          less: '<'
          less_or_equal: '<='
          greater: '>'
          greater_or_equal: '>='
          contains: 'includes'
          not_contains: 'excludes'
      filters: fieldList

    $('.table-responsive table').DataTable(
        'sScrollY': 'auto'
        'bFilter': false
        'bAutoWidth': true
        'bSort': false
        'sScrollX': '100%'
        'bInfo': false
        'bLengthChange': false
        'bPaginate': false
      )


  _handleSearch = ->
    $('#search').on 'click', ->
      rules =  JSON.stringify($('#builder').queryBuilder('getRules'))
      if !($.isEmptyObject($('#builder').queryBuilder('getRules')))
        $('#client_search_rules').val(rules)
        $('#advanced-search').submit()
         

  { init: _init }