import React from 'react'
import {
  SelectInput,
  TextInput
} from '../Commons/inputs'

export default props => {
  const { onChange, data: { client, quantitativeType, quantitativeCase } } = props

  const onChangeQuantitative = ({data, action, removed, type}) => {
    const selectedCases = client.quantitative_case_ids
    let value = []

    if (action === 'remove-value') {
      selectedCases.splice(selectedCases.indexOf(removed), 1)
      value = selectedCases
    } else if (action === 'select-option')
      value = [ ...new Set([ ...selectedCases, ...data])]
    else if (action === 'clear') {
      removed.forEach(removedValue => {
        selectedCases.splice(selectedCases.indexOf(removedValue), 1)
      })
      value = selectedCases
    }

    onChange('client', 'quantitative_case_ids')({data: value, type})
  }

  const renderQuantitativeCases = () => {
    return (
      quantitativeType.map((type, index) => {
        return (
          <div className="row" key={index}>
            <div className="col-md-12">
              <SelectInput
                isMulti
                label={type.name}
                value={client.quantitative_case_ids}
                onChange={onChangeQuantitative}
                options={ quantitativeCase.filter(ftr => { return ftr.quantitative_type_id === type.id }).map( qc => ({ label: qc.value, value: qc.id }) ) }
              />
            </div>
          </div>
        )
      })
    )
  }

  return (
    <div className="container">
      <legend>
        <div className="row">
          <div className="col-md-10">
            <p>Client / Referral - Vulnerability Information and Referral Note</p>
          </div>
        </div>
      </legend>

      { renderQuantitativeCases() }

      <div className="row">
        <div className="col-md-12">
          <TextInput textArea label="Enter a brief note on the client's referral:" onChange={onChange('client', 'relevant_referral_information')} value={client.relevant_referral_information}/>
        </div>
      </div>
    </div>
  )
}
