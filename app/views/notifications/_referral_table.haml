.table-responsive
  %table.table.table-bordered.table-striped.table-hover
    %thead 
      %thead 
        %th= t('.clients')
        %th= t('.referral_form')
        %th= t('.referral_date')
        %th= t('.referral_count')
        %th= t('.level_of_risk')
        %th= t('.review_form')
    %tbody
      - referrals.group_by(&:client_id).each do |_client_id, referral_group|
        - referral = referral_group.last
        - if action_name == 'repeat_referrals'
          - client = clients.find { |c| c.global_id == referral.client_global_id }
          - next unless client&.slug

        %tr
          %td
            = link_to referral_path(referral), target: '_blank' do
              = referral.client_name
          %td
            = link_to referral_path(referral), target: '_blank' do
              = referral.referred_from
          %td
            = link_to referral_path(referral), target: '_blank' do
              = date_format(referral.date_of_referral)
          %td
            = link_to referral_path(referral), target: '_blank' do
              = referral_group.count
          %td
            - if referral.level_of_risk.present?
              = link_to referral_path(referral), target: '_blank', class: 'btn btn-primary btn-xs' do
                = referral.level_of_risk.capitalize
            = status_style referral.referral_status
          %td.text-center
            = link_to referral_path(referral), target: '_blank', class: 'btn btn-primary btn-xs' do
              = fa_icon 'external-link'
            = link_to '#', target: '_blank', class: 'btn btn-danger btn-xs' do
              = fa_icon 'trash'
