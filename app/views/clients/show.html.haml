.row
  .col-xs-12
    .row
      .col-md-4
        %span.show-name
          = @client.name
        - if @client.status
          %span.show-status= status_style(@client.status)
        .client-info
          = @client.slug
          = @client.gender.titleize
      .col-md-6
        %table.table.small.m-b-xs
          %tbody
            %tr
              %td
                = "#{t('.code')} :"
                %strong= @client.care_code
              %td
                = "#{t('.date_of_birth')} :"
                %strong= @client.date_of_birth_format
            %tr
              %td
                = "#{t('.age')} :"
                %strong= @client.age
              %td
                = "#{t('.current_province')} :"
                %strong= @client.current_province
    .row
      - if @client.state == ''
        .col-xs-12.accept-layout
          = simple_form_for @client, method: :put, url: client_path(@client) do |f|
            .form-inputs
              = f.hidden_field :state, value: 'accepted'
            .form-action
              = f.submit t('.accept'), class: 'btn btn-success mini-margin agree-btn'
          %button.btn.btn-danger.mini-margin{"data-target" => '#rejectionForm', "data-toggle" => 'modal', class: 'agree-btn'} #{t('.reject')}
        #rejectionForm.modal.fade{ role: 'dialog', tabindex: '-1'}
          .modal-dialog{ role: 'document'}
            .modal-content
              .modal-header
                %button.close{"aria-label" => "#{t('close')}", "data-dismiss" => 'modal'}
                  %span{"aria-hidden" => 'true'} &times;
                %h4.modal-title
                  = t('.reject_client')
              .modal-body
                = simple_form_for(@client) do |f|
                  = f.error_notification
                  .form-inputs
                    = f.input :rejected_note, required: true, label: "#{t('.note')}"
                  .form-inputs
                    = f.hidden_field :state, value: 'rejected'
                  .form-actions.text-right
                    %button.btn.btn-default{"data-dismiss" => 'modal'} #{t('cancel')}
                    = f.button :submit, "#{t('.reject')}", class: 'btn btn-danger confirm-reject'

      - elsif @client.state == 'rejected'
        .col-xs-12.accept-layout
          = simple_form_for @client, method: :put, url: client_path(@client) do |f|
            .form-inputs
              = f.hidden_field :state, value: 'accepted'
            .form-actions
              = f.submit "#{t('.accept')}", class: 'btn mini-margin btn-success agree-btn'
          %button.btn.btn-danger.mini-margin{ disabled: 'disabled', class:'agree-btn' } #{t('.reject')}

      - elsif @client.state == 'accepted'
        .col-xs-12
          - if can? :manage, Case
            .btn-group.small-btn-margin
              %button.btn-xs.btn.btn-primary.dropdown-toggle{"data-toggle" => "dropdown"}
                = t('.add_client_to_case')
                %span.caret
              %ul.dropdown-menu
                - if @client.cases.current.blank?
                  %li= @client.ec_button
                  %li= @client.fc_button
                  %li= @client.kc_button
                - else
                  - unless @client.cases.current.fc_or_kc?
                    %li= @client.fc_button
                    %li= @client.kc_button

                - if @client.cases.active.any?
                  %li.divider
                  %li
                    %a{"data-target" => '#exitFromCif', "data-toggle" => 'modal'}
                      .text-warning= t('.exit_cif_btn')
            - if @client.cases.active.any?
              = render 'exit_case_form', client_case: @client.cases.active.last, exit_from_cif: true

          = link_to client_tasks_path(@client) do
            %span.btn-xs.btn.btn-info.small-btn-margin
              %strong.count-margin= @client.tasks.incomplete.count
              = t('.view_tasks')
          = link_to client_assessments_path(@client) do
            %span.btn-xs.btn.btn-info.small-btn-margin
              %strong.count-margin= @client.assessments.count
              = t('.view_assessments')
          = link_to client_case_notes_path(@client) do
            %span.btn-xs.btn.btn-info.small-btn-margin
              %strong.count-margin= @client.case_notes.count
              = t('.view_case_notes')
          = link_to new_client_survey_path(@client) do
            %span.btn-xs.btn.btn-success.small-btn-margin= t('.take_survey')
          - if @client.surveys.any?
            = link_to client_surveys_path(@client) do
              %span.btn-xs.btn.btn-success.small-btn-margin= t('.survey_history')
          = link_to client_government_reports_path(@client) do
            %span.btn-xs.btn.btn-success.small-btn-margin= t('.government_report')
          - if @client.has_any_quarterly_reports?
            - if can? :manage, QuarterlyReport
              = link_to client_case_quarterly_reports_path(@client,@client.latest_case) do
                %span.btn-xs.btn.color-brown.small-btn-margin= t('.view_legacy_quarterly_reports')
          - if @client.cases.inactive.present?
            .btn-group.small-btn-margin
              %button.btn-xs.btn.btn-warning.dropdown-toggle{"data-toggle" => "dropdown"}
                = t('.case_history')
                %span.caret
              %ul.dropdown-menu
                %li
                  - if @client.cases.emergencies.inactive.present? && ec_manageable
                    = link_to client_cases_path(@client, case_type: 'EC') do
                      %span.text-success= t('.view_ec_history_btn_link')
                %li
                  - if @client.cases.fosters.inactive.present? && fc_manageable
                    = link_to client_cases_path(@client, case_type: 'FC') do
                      %span.text-success= t('.view_fc_history_btn_link')
                %li
                  - if @client.cases.kinships.inactive.present? && kc_manageable
                    = link_to client_cases_path(@client, case_type: 'KC') do
                      %span.text-success= t('.view_kc_history_btn_link')
          - if can_read_client_progress_note?
            = link_to client_progress_notes_path(@client) do
              %span.btn-xs.btn.btn-warning.small-btn-margin= t('.progress_note')
          - if @client.answers.any?
            = link_to '', {"data-target" => "#myModal", "data-toggle" => "modal", :type => "button"} do
              %span.btn-xs.btn.btn-warning.small-btn-margin= t('.client_able_answers')
            = render('client_answers')

.row.mini-margin
  .col-xs-12
    .ibox
      .ibox-title
        %h5=t('.general_info')
        .ibox-tools
          %a.collapse-link
            .btn.btn-outline.btn-primary
              %i.fa.fa-chevron-up
          - if (can? :manage, Client) || (can? :rud, Client)
            %small
              = link_to edit_client_path(@client) do
                .btn.btn-outline.btn-success
                  %i.fa.fa-pencil
              = link_to @client, method: 'delete', data: { confirm: t('.are_you_sure') } do
                .btn.btn-outline.btn-danger
                  %i.fa.fa-trash
      .ibox-content
        .row
          .col-sm-12.col-md-6.first-table
            %table.table.table-bordered
              %tr
                %td.spacing-first-col
                  = t('.address')
                %td
                  %strong
                    = @client.current_address
              %tr
                %td.spacing-first-col
                  = t('.completed')
                %td
                  %strong
                    = human_boolean(@client.completed)
              %tr
                %td.spacing-first-col
                  = t('.birth_province')
                %td
                  %strong
                    = @client.birth_province
              %tr
                %td.spacing-first-col
                  = t('.time_in_care')
                %td
                  %strong
                    = @client.time_in_care
              %tr
                %td.spacing-first-col
                  = t('.initial_referral_date')
                %td
                  %strong
                    = @client.referral_date
              %tr
                %td.spacing-first-col
                  = t('.referral_source')
                %td
                  %strong
                    = @client.referral_source
              %tr
                %td.spacing-first-col
                  = t('.referral_phone')
                %td
                  %strong
                    = @client.referral_phone
              %tr
                %td.spacing-first-col
                  = t('.received_by')
                %td
                  %strong
                    = user @client.received_by
              %tr
                %td.spacing-first-col
                  = t('.followed_up_by')
                %td
                  %strong
                    = user @client.followed_up_by
              %tr
                %td.spacing-first-col
                  = t('.follow_up_date')
                %td
                  %strong
                    = @client.follow_up_date.strftime('%B %d, %Y') if @client.follow_up_date

          .col-sm-12.col-md-6.second-table
            %table.table.table-bordered
              %tr
                %td.spacing-first-col
                  = t('.school_name')
                %td
                  %strong
                    = @client.school_name
              %tr
                %td.spacing-first-col
                  = t('.school_grade')
                %td
                  %strong
                    = @client.grade
              %tr
                %td.spacing-first-col
                  = "#{t('.has_been_in_orphanage')}?"
                %td
                  %strong
                    = human_boolean(@client.has_been_in_orphanage)
              %tr
                %td.spacing-first-col
                  = "#{t('.able_state')}"
                %td
                  %strong
                    = @client.able_state
              %tr
                %td.spacing-first-col
                  = "#{t('.has_been_in_government_care')}?"
                %td
                  %strong
                    = human_boolean(@client.has_been_in_government_care)
              %tr
                %td.spacing-first-col
                  = t('.relevant_referral_information')
                %td
                  %strong
                    = @client.relevant_referral_information
              %tr
                %td.spacing-first-col
                  = t('.case_worker_or_staff')
                %td
                  %strong
                    = user @client.user if @client.user
              %tr
                %td.spacing-first-col
                  = t('.agencies_involved')
                %td
                  - @client.agencies.each do|agency|
                    %strong.label.label-default{style:'margin-right: 2px;'}
                      = agency.name
              = render 'state'
        .row
          .col-xs-12
            %table.table.table-bordered
              - @client.quantitative_cases.group_by(&:quantitative_type).each do |qtypes|
                %tr.custom-label
                  %td.align-justify
                    = qtypes.first.name
                  %td.align-justify
                    %ul
                      - qtypes.last.each do |qcase|
                        %li
                          %b
                            = qcase.value
                        %br/
.row
  = render 'placement'
