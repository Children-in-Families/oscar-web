.row#assessment
  .col-xs-12
    .ibox
      .ibox-title
        %h5= I18n.t('data_trackers.index.assessments')
        .ibox-tools
          %a.collapse-link
            %i.fa.fa-chevron-up
      .ibox-content
        - assessmets.each_with_index do |assessment, index|
          .row
            .col-xs-12
              %p
                %b= "#{I18n.t('assessments.show.case_plan')} #{assessment.client.name}"
                %label{ class: "#{assessment.completed_label_class}"}= assessment.completed_status
                %br
                - if assessment.index_of == 0
                  = "#{I18n.t('assessments.show.initial_assessment')}"
                - else
                  = "#{I18n.t('assessments.show.based_on')} #{assessment.index_of + 1}"
                %br
                = "#{I18n.t('assessments.show.assessment_created_by')} #{whodunnit('Assessment', assessment)} #{I18n.t('assessments.show.on_date')} #{date_format(assessment.created_at)}"
          - assessment.assessment_domains_in_order.each do |ad|
            .row
              .col-xs-12
                %div{class: "panel panel-#{ad.score_color_class}"}
                  .panel-heading
                    %table.table.table-borderless
                      %tbody
                        %tr
                          %td.no-padding-bottom
                            %b= "#{I18n.t('assessments.show.domain')} #{ad.domain.name}:"
                          %td.no-padding-bottom
                            %b= ad.domain.identity
                          %td{rowspan: 4}
                            .domain-score.text-center
                              - unless assessment.initial?
                                %button{ 'data-original-title': "#{simple_format(ad.previous_score_definition)}", type: 'button', class: "btn btn-#{ad.previous_score_color_class} btn-xs", 'data-toggle': 'tooltip' }
                                  = "#{ad.previous_score}"
                                %span{style: 'color:black;'} &#8594;
                              %button{ 'data-original-title': "#{simple_format(ad.score_definition)}", type: 'button', class: "btn btn-#{ad.score_color_class} btn-xs", 'data-toggle': 'tooltip' }
                                = "#{ad.score}"
                        %tr
                          %td.no-padding-top
                            %b= "#{I18n.t('assessments.show.score')} #{ad.score}:"
                          %td.no-padding-top
                            %b= simple_format(ad.score_definition)
                        %tr
                          %td
                            %b= "#{I18n.t('assessments.show.reason')}:"
                          %td
                            = ad.reason
                        %tr
                          %td
                            %b= "#{I18n.t('assessments.show.goal')}:"
                          %td
                            = ad.try(:goal)
                        - incomplete_tasks = @client.tasks.by_domain_id(ad.domain_id).incomplete
                        - if incomplete_tasks.any?
                          %tr
                            %td
                              %b= "#{I18n.t('assessments.show.task')}:"
                            %td
                              - incomplete_tasks.each do |task|
                                %li= "#{task.name} (#{I18n.t('assessments.show.due_date')}: #{date_format(task.completion_date)})"
                        %tr
                          %td
                          %td
                            - if ad.attachments.any?
                              %br
                              %button.btrn.btn-info.btn-sm{"data-target" => "#attachments#{ad.id}", "data-toggle" => "modal", :type => "button"}= I18n.t('assessments.show.show_attachment')
                  - if ad.attachments.any?
                    = render 'attachment', { ad: ad }

