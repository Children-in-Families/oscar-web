namespace :agh do
  desc 'Re-Import A Greater Hope data'
  task reimport: :environment do
    # org = Organization.create_and_build_tanent(short_name: 'agh', full_name: "A Greater Hope", logo: File.open(Rails.root.join('app/assets/images/agh.jpg')))
    # Organization.switch_to org.short_name
    Organization.switch_to 'agh'

    Client.all.each do |client|
      next unless client.kid_id.present?
      client.kid_id = client.kid_id.to_i.to_s
      client.save(validate: false)
    end

    import = AghReimporter::Import.new('Clients')
    import.clients

    sheet = [1034,1035,1036,1038,1039,1040,1043,1045,1050,1051,1054,1059,1060,1061,1063,1064,1065,1074,1079,1119,1125,1134,1140,1141,1147,1151,1156,1159,1161,1165,1166,1168,1173,1186,1188,1082,1083,1085,1090,1092,1096,1098,1099,1100,1105,1107,1112,1113,1114,1118,1121,1127,1128,1131,1133,1135,1142,1146,1149,1153,134,1177,1179,1182,1187,1189,838,842,843,858,859,860,863,870,874,876,878,880,883,884,905,914,920,923,928,929,933,934,935,936,946,999,1000,1001,1006,1007,1008,1018,1023,1031,1032,949,952,956,964,965,978,979,982,987,991,1011,1019,1026,1030,1037,1042,1046,1048,1049,1052,1053,1070,1073,1076,1077,1078,1088,1089,1091,1101,1111,1120,1139,1150,1152,568,664,667,669,674,692,709,711,712,715,719,720,726,729,740,741,756,764,765,821,822,825,829,831,832,837,856,867,868,886,898,903,915,921,994,675,687,694,710,713,724,727,737,738,745,759,770,787,791,810,811,815,833,836,844,848,861,865,871,899,916,922,932,959,970,972,984,988,996,1013,1075,409,437,569,570,571,572,575,578,579,580,581,582,584,585,592,594,595,597,598,599,600,602,604,605,606,607,615,638,660,663,665,668,698,869,897,1116,670,672,673,677,679,683,686,688,693,697,699,700,701,702,703,704,705,706,707,730,734,735,736,743,746,751,757,794,805,809,875,891,931,1067,1122,319,364,392,413,416,417,418,422,423,424,426,430,434,435,438,439,440,458,459,484,574,659,661,662,766,799,892,904,958,1033,1157,1158,1162,1171,1183,316,503,517,525,539,540,541,542,544,547,552,555,556,561,563,565,611,642,689,760,768,774,784,792,849,855,881,909,930,966,967,973,998,1184,132,210,287,290,292,294,298,301,307,322,339,369,370,374,375,376,377,404,405,433,468,560,763,806,808,900,1029,1084,1086,1087,1104,1185,291,293,297,299,304,305,310,311,312,313,314,315,320,321,327,358,398,436,474,495,497,518,553,750,755,758,762,767,803,804,885,945,971,1103,1130,37,135,176,200,222,227,249,325,335,336,338,347,348,350,351,357,378,513,656,732,754,798,813,817,872,908,918,943,950,962,1017,1110,20,25,161,162,164,165,168,202,213,251,329,337,341,353,356,373,397,457,483,514,522,690,742,752,777,790,990,1014,1062,1071,1097,1145,1155,333,359,361,371,379,380,382,469,476,515,641,718,748,776,795,853,857,882,980,997,1002,1010,1041,1081,1095,1148,1178,1181,28,31,46,47,48,62,63,133,166,169,170,172,199,205,218,223,224,228,232,471,502,612,630,1004,21,29,33,34,35,38,45,61,87,89,90,91,99,127,147,174,175,178,187,189,385,479,643,695,717,731,862,864,873,888,893,896,925,944,1123,1129,1137,1,2,24,51,53,57,58,81,82,84,88,92,94,95,104,125,191,234,613,761,781,854,890,911,927,951,1057,1069,1093,1124,1126,1132,1143,12,41,136,137,139,142,143,183,185,221,489,800,801,802,826,850,851,985,1144,1154,1172,3,4,5,6,11,66,68,69,77,118,124,146,156,207,233,244,256,462,473,509,819,840,841,852,976,1044,1047,1055,1056,1058,1066,1072,1094,1109,1136,10,72,78,258,260,269,747,981,986,1108,1138,1163,1169,1170,13,17,79,194,204,265,445,446,529,531,533,895]

    all = Client.all.map { |client| client.kid_id.to_i }

    to_be_remove_kid_id = all - sheet + ['', nil]

    Client.where(kid_id: to_be_remove_kid_id).destroy_all
  end
end
